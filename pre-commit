#!/bin/sh

# --- Constants ---
ESLINT="npx lint"
PRETTIER="npx format:check"

# --- Get staged JS/TS/CSS/SCSS files ---
files=$(git diff --cached --name-only --diff-filter=AMCR -- '*.js' '*.jsx' '*.ts' '*.tsx' '*.css' '*.scss')

if [ -z "$files" ]; then
  echo "‚úÖ No files staged for commit."
  exit 0
fi

echo "üöÄ Running ESLint and Prettier checks..."

# --- Run ESLint (only on JS/TS files) ---
js_files=$(echo "$files" | grep -E '\.(js|jsx|ts|tsx)$')
if [ -n "$js_files" ]; then
  echo "Checking JavaScript/TypeScript files with ESLint..."
  if ! $ESLINT $js_files; then
    echo "‚ùå ESLint failed. Please fix issues or run: npx eslint . --fix"
    exit 1
  fi
else
  echo "‚úÖ No JS/TS files to lint."
fi

# --- Run Prettier check (on all supported files) ---
echo "üé® Checking format with Prettier..."
if ! $PRETTIER --check $files; then
  echo "‚ùå Prettier check failed. Please run: npx prettier --write ."
  exit 1
fi

echo "‚úÖ ESLint and Prettier passed!"
exit 0
